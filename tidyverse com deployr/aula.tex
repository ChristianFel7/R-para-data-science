% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math} % this also loads fontspec
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else
  % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage{bookmark}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same}
\hypersetup{
  pdftitle={R Notebook},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{R Notebook}
\author{}
\date{\vspace{-2.5em}}

\begin{document}
\maketitle

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## -- Attaching core tidyverse packages ------------------------ tidyverse 2.0.0 --
## v dplyr     1.1.4     v readr     2.1.5
## v forcats   1.0.0     v stringr   1.5.1
## v ggplot2   3.5.1     v tibble    3.2.1
## v lubridate 1.9.4     v tidyr     1.3.1
## v purrr     1.0.2     
## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()
## i Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{transacoes\_milhas }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"transacoes\_milhas.csv"}\NormalTok{, }\AttributeTok{show\_col\_types =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(transacoes\_milhas)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 4
##   id_cliente data_venda_milhas milhas_vendidas valor_recebido
##        <dbl> <date>                      <dbl>          <dbl>
## 1        350 2023-02-23                   4131           537.
## 2        109 2022-09-26                   6525           114.
## 3        376 2022-06-12                   9955           467.
## 4        443 2022-12-17                   5913          1490.
## 5        647 2023-10-06                    284          1908.
## 6        818 2023-05-29                   4225          1339.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{clientes }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"clientes.csv"}\NormalTok{, }\AttributeTok{show\_col\_types =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{transacoes\_passagens }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"transacoes\_passagens.csv"}\NormalTok{, }\AttributeTok{show\_col\_types =} \ConstantTok{FALSE}\NormalTok{)}
\FunctionTok{head}\NormalTok{(clientes)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 5
##   id_cliente data_nascimento status_fidelidade milhas_acumuladas gasto_total
##        <dbl> <date>          <chr>                         <dbl>       <dbl>
## 1          1 1971-01-09      Diamante                       2833       1907.
## 2          2 1996-08-11      Diamante                       8864        494.
## 3          3 1994-07-18      Diamante                        917        519.
## 4          4 2003-03-08      Prata                          8773       1257.
## 5          5 1962-06-05      Diamante                       1492        410.
## 6          6 1988-02-08      Prata                          6270        251.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(transacoes\_passagens)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 6
##   id_cliente data_transacao milhas_utilizadas valor_pago classe_voo   numero_voo
##        <dbl> <date>                     <dbl>      <dbl> <chr>             <dbl>
## 1        507 2023-01-30                  9837       424. Economica          3705
## 2         86 2023-03-07                  6067       514. Economica          9504
## 3        589 2022-02-11                  2893      1320. Primeira Cl~       1695
## 4        774 2022-09-23                  2274      1000. Economica          2963
## 5        705 2023-06-08                  6043      1607. Economica          9190
## 6        316 2023-05-13                  1798      1803. Executiva          6242
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{transacoes\_milhas }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 1,000
## Columns: 4
## $ id_cliente        <dbl> 350, 109, 376, 443, 647, 818, 32, 770, 707, 842, 170~
## $ data_venda_milhas <date> 2023-02-23, 2022-09-26, 2022-06-12, 2022-12-17, 202~
## $ milhas_vendidas   <dbl> 4131, 6525, 9955, 5913, 284, 4225, 2854, 6127, 5091,~
## $ valor_recebido    <dbl> 536.88, 113.70, 466.73, 1489.56, 1908.38, 1339.10, 1~
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{clientes }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 1,000
## Columns: 5
## $ id_cliente        <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 1~
## $ data_nascimento   <date> 1971-01-09, 1996-08-11, 1994-07-18, 2003-03-08, 196~
## $ status_fidelidade <chr> "Diamante", "Diamante", "Diamante", "Prata", "Diaman~
## $ milhas_acumuladas <dbl> 2833, 8864, 917, 8773, 1492, 6270, 2583, 8263, 8914,~
## $ gasto_total       <dbl> 1906.69, 493.58, 519.16, 1256.60, 410.37, 250.93, 92~
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{transacoes\_passagens }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 1,000
## Columns: 6
## $ id_cliente        <dbl> 507, 86, 589, 774, 705, 316, 801, 149, 11, 154, 363,~
## $ data_transacao    <date> 2023-01-30, 2023-03-07, 2022-02-11, 2022-09-23, 202~
## $ milhas_utilizadas <dbl> 9837, 6067, 2893, 2274, 6043, 1798, 4354, 6976, 6344~
## $ valor_pago        <dbl> 424.31, 513.52, 1320.34, 1000.44, 1607.35, 1802.67, ~
## $ classe_voo        <chr> "Economica", "Economica", "Primeira Classe", "Econom~
## $ numero_voo        <dbl> 3705, 9504, 1695, 2963, 9190, 6242, 2415, 6747, 3509~
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{transacoes\_passagens }\OtherTok{\textless{}{-}}\NormalTok{ transacoes\_passagens }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(id\_cliente, data\_transacao, milhas\_utilizadas, valor\_pago)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{transacoes\_passagens }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 1,000
## Columns: 4
## $ id_cliente        <dbl> 507, 86, 589, 774, 705, 316, 801, 149, 11, 154, 363,~
## $ data_transacao    <date> 2023-01-30, 2023-03-07, 2022-02-11, 2022-09-23, 202~
## $ milhas_utilizadas <dbl> 9837, 6067, 2893, 2274, 6043, 1798, 4354, 6976, 6344~
## $ valor_pago        <dbl> 424.31, 513.52, 1320.34, 1000.44, 1607.35, 1802.67, ~
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{transacoes\_milhas }\OtherTok{\textless{}{-}}\NormalTok{ transacoes\_milhas }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(data\_venda\_milhas }\SpecialCharTok{\textgreater{}=} \StringTok{"2022{-}01{-}01"} \SpecialCharTok{\&}\NormalTok{ data\_venda\_milhas }\SpecialCharTok{\textless{}=} \StringTok{"2022{-}12{-}31"}\NormalTok{)}
\NormalTok{transacoes\_milhas }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 485
## Columns: 4
## $ id_cliente        <dbl> 109, 376, 443, 32, 842, 609, 391, 600, 101, 761, 959~
## $ data_venda_milhas <date> 2022-09-26, 2022-06-12, 2022-12-17, 2022-12-06, 202~
## $ milhas_vendidas   <dbl> 6525, 9955, 5913, 2854, 5686, 937, 1190, 8295, 635, ~
## $ valor_recebido    <dbl> 113.70, 466.73, 1489.56, 1983.85, 191.69, 183.50, 47~
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{transacoes\_passagens }\OtherTok{\textless{}{-}}\NormalTok{ transacoes\_passagens }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(data\_transacao }\SpecialCharTok{\textgreater{}=} \StringTok{"2022{-}01{-}01"} \SpecialCharTok{\&}\NormalTok{ data\_transacao }\SpecialCharTok{\textless{}=} \StringTok{"2022{-}12{-}31"}\NormalTok{)}
\NormalTok{transacoes\_passagens }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 502
## Columns: 4
## $ id_cliente        <dbl> 589, 774, 149, 620, 96, 449, 693, 242, 358, 317, 633~
## $ data_transacao    <date> 2022-02-11, 2022-09-23, 2022-11-07, 2022-08-12, 202~
## $ milhas_utilizadas <dbl> 2893, 2274, 6976, 6479, 9444, 8102, 5335, 7139, 7280~
## $ valor_pago        <dbl> 1320.34, 1000.44, 309.56, 1869.74, 267.63, 268.38, 1~
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{transacoes\_passagens }\OtherTok{\textless{}{-}}\NormalTok{ transacoes\_passagens }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\AttributeTok{custo\_por\_milha =}\NormalTok{ valor\_pago }\SpecialCharTok{/}\NormalTok{ milhas\_utilizadas)}
\NormalTok{transacoes\_passagens }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 502
## Columns: 5
## $ id_cliente        <dbl> 589, 774, 149, 620, 96, 449, 693, 242, 358, 317, 633~
## $ data_transacao    <date> 2022-02-11, 2022-09-23, 2022-11-07, 2022-08-12, 202~
## $ milhas_utilizadas <dbl> 2893, 2274, 6976, 6479, 9444, 8102, 5335, 7139, 7280~
## $ valor_pago        <dbl> 1320.34, 1000.44, 309.56, 1869.74, 267.63, 268.38, 1~
## $ custo_por_milha   <dbl> 0.45639129, 0.43994723, 0.04437500, 0.28858466, 0.02~
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{media\_milhas }\OtherTok{\textless{}{-}}\NormalTok{ transacoes\_passagens }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{group\_by}\NormalTok{(id\_cliente) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{summarise}\NormalTok{(}\AttributeTok{media\_milhas =} \FunctionTok{mean}\NormalTok{(milhas\_utilizadas))}
\NormalTok{media\_milhas }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 2
##   id_cliente media_milhas
##        <dbl>        <dbl>
## 1          3        1023 
## 2          7        7074.
## 3         10        6537 
## 4         12        9312 
## 5         13        4123 
## 6         15        7541
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(transacoes\_passagens)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 5
##   id_cliente data_transacao milhas_utilizadas valor_pago custo_por_milha
##        <dbl> <date>                     <dbl>      <dbl>           <dbl>
## 1        589 2022-02-11                  2893      1320.          0.456 
## 2        774 2022-09-23                  2274      1000.          0.440 
## 3        149 2022-11-07                  6976       310.          0.0444
## 4        620 2022-08-12                  6479      1870.          0.289 
## 5         96 2022-05-23                  9444       268.          0.0283
## 6        449 2022-10-16                  8102       268.          0.0331
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{transacoes\_passagens }\OtherTok{\textless{}{-}}\NormalTok{ transacoes\_passagens }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{arrange}\NormalTok{(data\_transacao)}
\FunctionTok{head}\NormalTok{(transacoes\_passagens)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 5
##   id_cliente data_transacao milhas_utilizadas valor_pago custo_por_milha
##        <dbl> <date>                     <dbl>      <dbl>           <dbl>
## 1        967 2022-01-01                  1198      1217.           1.02 
## 2        747 2022-01-01                  8451      1064.           0.126
## 3        237 2022-01-01                  7996      1685.           0.211
## 4        504 2022-01-02                  6143       693.           0.113
## 5        840 2022-01-02                  5267      1497.           0.284
## 6        396 2022-01-02                  1929       760.           0.394
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(transacoes\_milhas)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 4
##   id_cliente data_venda_milhas milhas_vendidas valor_recebido
##        <dbl> <date>                      <dbl>          <dbl>
## 1        109 2022-09-26                   6525           114.
## 2        376 2022-06-12                   9955           467.
## 3        443 2022-12-17                   5913          1490.
## 4         32 2022-12-06                   2854          1984.
## 5        842 2022-05-29                   5686           192.
## 6        609 2022-11-09                    937           184.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{transacoes\_milhas }\OtherTok{\textless{}{-}}\NormalTok{ transacoes\_milhas }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{arrange}\NormalTok{(data\_venda\_milhas)}
\FunctionTok{head}\NormalTok{(transacoes\_milhas)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 4
##   id_cliente data_venda_milhas milhas_vendidas valor_recebido
##        <dbl> <date>                      <dbl>          <dbl>
## 1        619 2022-01-01                   4385          1837.
## 2        323 2022-01-01                   8808          1023.
## 3        963 2022-01-01                   6560          1883.
## 4        745 2022-01-02                   4810          1685.
## 5        299 2022-01-02                   1916           989.
## 6        797 2022-01-02                   3026          1970.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{transacoes\_passagens }\OtherTok{\textless{}{-}}\NormalTok{ transacoes\_passagens }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{left\_join}\NormalTok{(clientes, }\AttributeTok{by=} \StringTok{"id\_cliente"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(transacoes\_passagens)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 9
##   id_cliente data_transacao milhas_utilizadas valor_pago custo_por_milha
##        <dbl> <date>                     <dbl>      <dbl>           <dbl>
## 1        967 2022-01-01                  1198      1217.           1.02 
## 2        747 2022-01-01                  8451      1064.           0.126
## 3        237 2022-01-01                  7996      1685.           0.211
## 4        504 2022-01-02                  6143       693.           0.113
## 5        840 2022-01-02                  5267      1497.           0.284
## 6        396 2022-01-02                  1929       760.           0.394
## # i 4 more variables: data_nascimento <date>, status_fidelidade <chr>,
## #   milhas_acumuladas <dbl>, gasto_total <dbl>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{transacoes\_passagens }\OtherTok{\textless{}{-}}\NormalTok{ transacoes\_passagens }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{rename}\NormalTok{(}
  \CommentTok{\#Data\_Compra\_Passagem = data\_transacao,}
  \AttributeTok{Milhas\_Utilizadas =}\NormalTok{ milhas\_utilizadas,}
  \AttributeTok{Valor\_Pago =}\NormalTok{ valor\_pago,}
  \AttributeTok{Custo\_Por\_Milha =}\NormalTok{ custo\_por\_milha,}
  \AttributeTok{Data\_Nascimento =}\NormalTok{ data\_nascimento,}
  \AttributeTok{Status\_Fidelidade =}\NormalTok{ status\_fidelidade,}
  \AttributeTok{Milhas\_Acumuladas =}\NormalTok{ milhas\_acumuladas,}
  \AttributeTok{Gasto\_Total =}\NormalTok{ gasto\_total}
\NormalTok{) }
\FunctionTok{head}\NormalTok{(transacoes\_passagens)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 9
##   id_cliente data_transacao Milhas_Utilizadas Valor_Pago Custo_Por_Milha
##        <dbl> <date>                     <dbl>      <dbl>           <dbl>
## 1        967 2022-01-01                  1198      1217.           1.02 
## 2        747 2022-01-01                  8451      1064.           0.126
## 3        237 2022-01-01                  7996      1685.           0.211
## 4        504 2022-01-02                  6143       693.           0.113
## 5        840 2022-01-02                  5267      1497.           0.284
## 6        396 2022-01-02                  1929       760.           0.394
## # i 4 more variables: Data_Nascimento <date>, Status_Fidelidade <chr>,
## #   Milhas_Acumuladas <dbl>, Gasto_Total <dbl>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{transacoes\_passagens }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{count}\NormalTok{(id\_cliente) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{rename}\NormalTok{(}\AttributeTok{Total\_Compras =}\NormalTok{ n) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{arrange}\NormalTok{(}\FunctionTok{desc}\NormalTok{(Total\_Compras)) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 2
##   id_cliente Total_Compras
##        <dbl>         <int>
## 1        586             5
## 2        544             4
## 3        861             4
## 4        175             3
## 5        207             3
## 6        239             3
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dados\_milhas }\OtherTok{\textless{}{-}}\NormalTok{ transacoes\_passagens }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(id\_cliente, Milhas\_Utilizadas)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{total\_milhas\_por\_cliente }\OtherTok{\textless{}{-}}\NormalTok{ dados\_milhas }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{group\_by}\NormalTok{(id\_cliente) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{summarise}\NormalTok{(}\AttributeTok{total\_milhas =} \FunctionTok{sum}\NormalTok{(Milhas\_Utilizadas))}
\NormalTok{total\_milhas\_por\_cliente }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 2
##   id_cliente total_milhas
##        <dbl>        <dbl>
## 1          3         1023
## 2          7        14149
## 3         10         6537
## 4         12         9312
## 5         13         4123
## 6         15         7541
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{total\_milhas\_por\_cliente }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{arrange}\NormalTok{(}\FunctionTok{desc}\NormalTok{(total\_milhas)) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 2
##   id_cliente total_milhas
##        <dbl>        <dbl>
## 1        544        28726
## 2        572        22209
## 3        890        19566
## 4         96        19047
## 5        945        18514
## 6         32        18126
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Categorização por milhas utilizadas, baixo(\textless{}2000), medio(2000\textless{} \textless{}5000) e alto(5000+)}
\NormalTok{transacoes\_passagens }\OtherTok{\textless{}{-}}\NormalTok{ transacoes\_passagens }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}
  \AttributeTok{categoria\_cliente =} \FunctionTok{case\_when}\NormalTok{(}
\NormalTok{    Milhas\_Utilizadas }\SpecialCharTok{\textless{}} \DecValTok{2000} \SpecialCharTok{\textasciitilde{}} \StringTok{"Baixo"}\NormalTok{,}
\NormalTok{    Milhas\_Utilizadas }\SpecialCharTok{\textless{}} \DecValTok{5000} \SpecialCharTok{\textasciitilde{}} \StringTok{"Médio"}\NormalTok{,}
    \ConstantTok{TRUE} \SpecialCharTok{\textasciitilde{}} \StringTok{"Alto"}
\NormalTok{  )}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(transacoes\_passagens)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 10
##   id_cliente data_transacao Milhas_Utilizadas Valor_Pago Custo_Por_Milha
##        <dbl> <date>                     <dbl>      <dbl>           <dbl>
## 1        967 2022-01-01                  1198      1217.           1.02 
## 2        747 2022-01-01                  8451      1064.           0.126
## 3        237 2022-01-01                  7996      1685.           0.211
## 4        504 2022-01-02                  6143       693.           0.113
## 5        840 2022-01-02                  5267      1497.           0.284
## 6        396 2022-01-02                  1929       760.           0.394
## # i 5 more variables: Data_Nascimento <date>, Status_Fidelidade <chr>,
## #   Milhas_Acumuladas <dbl>, Gasto_Total <dbl>, categoria_cliente <chr>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Entendendo o funcionamento do cliente, se ele esta usando mais milhas e a perspectiva para o futuro}
\NormalTok{transacoes\_passagens }\OtherTok{\textless{}{-}}\NormalTok{ transacoes\_passagens }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{arrange}\NormalTok{(id\_cliente, data\_transacao)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(id\_cliente) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{diferenca\_milhas\_usadas =}\NormalTok{ Milhas\_Utilizadas }\SpecialCharTok{{-}} \FunctionTok{lag}\NormalTok{(Milhas\_Utilizadas),}
    \AttributeTok{valor\_futuro =} \FunctionTok{lead}\NormalTok{(Milhas\_Utilizadas)}
\NormalTok{  )}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ungroup}\NormalTok{()}

\FunctionTok{head}\NormalTok{(transacoes\_passagens)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 12
##   id_cliente data_transacao Milhas_Utilizadas Valor_Pago Custo_Por_Milha
##        <dbl> <date>                     <dbl>      <dbl>           <dbl>
## 1          3 2022-03-24                  1023      1588.          1.55  
## 2          7 2022-09-16                  9449      1906.          0.202 
## 3          7 2022-12-07                  4700      1286.          0.274 
## 4         10 2022-06-07                  6537       469.          0.0718
## 5         12 2022-10-29                  9312       570.          0.0612
## 6         13 2022-09-07                  4123       240.          0.0583
## # i 7 more variables: Data_Nascimento <date>, Status_Fidelidade <chr>,
## #   Milhas_Acumuladas <dbl>, Gasto_Total <dbl>, categoria_cliente <chr>,
## #   diferenca_milhas_usadas <dbl>, valor_futuro <dbl>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{any}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(transacoes\_passagens))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sum}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(transacoes\_passagens))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 788
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{num\_clientes }\OtherTok{\textless{}{-}}\NormalTok{ transacoes\_passagens }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{summarise}\NormalTok{(}\AttributeTok{num\_clientes =} \FunctionTok{n\_distinct}\NormalTok{(id\_cliente))}
\NormalTok{num\_clientes}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 1
##   num_clientes
##          <int>
## 1          394
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{transacoes\_passagens }\OtherTok{\textless{}{-}}\NormalTok{ transacoes\_passagens }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}
  \AttributeTok{diferenca\_milhas\_usadas =} \FunctionTok{coalesce}\NormalTok{(diferenca\_milhas\_usadas, }\DecValTok{0}\NormalTok{),}
  \AttributeTok{valor\_futuro =} \FunctionTok{coalesce}\NormalTok{(valor\_futuro, }\DecValTok{0}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{transacoes\_passagens }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{arrange}\NormalTok{(}\FunctionTok{desc}\NormalTok{(diferenca\_milhas\_usadas)) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{head}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 12
##    id_cliente data_transacao Milhas_Utilizadas Valor_Pago Custo_Por_Milha
##         <dbl> <date>                     <dbl>      <dbl>           <dbl>
##  1        625 2022-12-30                  7566      1891.          0.250 
##  2        961 2022-12-30                  7215       594.          0.0824
##  3        151 2022-08-28                  8923       689.          0.0772
##  4        820 2022-11-09                  9658       473.          0.0490
##  5        807 2022-10-24                  7239       361.          0.0499
##  6        370 2022-09-23                  8858       884.          0.0999
##  7        586 2022-11-20                  9478      1070.          0.113 
##  8        945 2022-12-19                  7559      1442.          0.191 
##  9        332 2022-09-13                  8010      1669.          0.208 
## 10        524 2022-05-01                  7567      1649.          0.218 
## # i 7 more variables: Data_Nascimento <date>, Status_Fidelidade <chr>,
## #   Milhas_Acumuladas <dbl>, Gasto_Total <dbl>, categoria_cliente <chr>,
## #   diferenca_milhas_usadas <dbl>, valor_futuro <dbl>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{transacoes\_passagens }\OtherTok{\textless{}{-}}\NormalTok{ transacoes\_passagens }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{categoria\_cliente =} 
    \FunctionTok{recode}\NormalTok{(categoria\_cliente,}
          \StringTok{"Baixo"} \OtherTok{=} \StringTok{"Iniciante"}\NormalTok{,}
          \StringTok{"Médio"} \OtherTok{=} \StringTok{"Intermediário"}\NormalTok{,}
          \StringTok{"Alto"} \OtherTok{=} \StringTok{"Avancado"}
\NormalTok{  )}
\NormalTok{)}
\FunctionTok{head}\NormalTok{(transacoes\_passagens)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 12
##   id_cliente data_transacao Milhas_Utilizadas Valor_Pago Custo_Por_Milha
##        <dbl> <date>                     <dbl>      <dbl>           <dbl>
## 1          3 2022-03-24                  1023      1588.          1.55  
## 2          7 2022-09-16                  9449      1906.          0.202 
## 3          7 2022-12-07                  4700      1286.          0.274 
## 4         10 2022-06-07                  6537       469.          0.0718
## 5         12 2022-10-29                  9312       570.          0.0612
## 6         13 2022-09-07                  4123       240.          0.0583
## # i 7 more variables: Data_Nascimento <date>, Status_Fidelidade <chr>,
## #   Milhas_Acumuladas <dbl>, Gasto_Total <dbl>, categoria_cliente <chr>,
## #   diferenca_milhas_usadas <dbl>, valor_futuro <dbl>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{transacoes\_passagens }\OtherTok{\textless{}{-}}\NormalTok{ transacoes\_passagens }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{Alto =} \ConstantTok{NULL}\NormalTok{)}
\FunctionTok{head}\NormalTok{(transacoes\_passagens)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 12
##   id_cliente data_transacao Milhas_Utilizadas Valor_Pago Custo_Por_Milha
##        <dbl> <date>                     <dbl>      <dbl>           <dbl>
## 1          3 2022-03-24                  1023      1588.          1.55  
## 2          7 2022-09-16                  9449      1906.          0.202 
## 3          7 2022-12-07                  4700      1286.          0.274 
## 4         10 2022-06-07                  6537       469.          0.0718
## 5         12 2022-10-29                  9312       570.          0.0612
## 6         13 2022-09-07                  4123       240.          0.0583
## # i 7 more variables: Data_Nascimento <date>, Status_Fidelidade <chr>,
## #   Milhas_Acumuladas <dbl>, Gasto_Total <dbl>, categoria_cliente <chr>,
## #   diferenca_milhas_usadas <dbl>, valor_futuro <dbl>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{transacoes\_passagens }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(id\_cliente, Milhas\_Utilizadas, Milhas\_Acumuladas)}\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 3
##   id_cliente Milhas_Utilizadas Milhas_Acumuladas
##        <dbl>             <dbl>             <dbl>
## 1          3              1023               917
## 2          7              9449              2583
## 3          7              4700              2583
## 4         10              6537              3829
## 5         12              9312              8857
## 6         13              4123              2228
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_long }\OtherTok{\textless{}{-}}\NormalTok{ transacoes\_passagens }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{pivot\_longer}\NormalTok{(}
    \AttributeTok{cols =} \FunctionTok{starts\_with}\NormalTok{(}\StringTok{"Milhas"}\NormalTok{),}
    \AttributeTok{names\_to =} \StringTok{"tipo\_milhas"}\NormalTok{,}
    \AttributeTok{values\_to =} \StringTok{"quantidade"}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(id\_cliente, tipo\_milhas, quantidade)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(df\_long)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 3
##   id_cliente tipo_milhas       quantidade
##        <dbl> <chr>                  <dbl>
## 1          3 Milhas_Utilizadas       1023
## 2          3 Milhas_Acumuladas        917
## 3          7 Milhas_Utilizadas       9449
## 4          7 Milhas_Acumuladas       2583
## 5          7 Milhas_Utilizadas       4700
## 6          7 Milhas_Acumuladas       2583
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_long }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(id\_cliente, tipo\_milhas) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}
    \AttributeTok{media =} \FunctionTok{mean}\NormalTok{(quantidade),}
    \AttributeTok{mediana =} \FunctionTok{median}\NormalTok{(quantidade),}
    \AttributeTok{desvio\_padrao =} \FunctionTok{sd}\NormalTok{(quantidade)}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `summarise()` has grouped output by 'id_cliente'. You can override using the
## `.groups` argument.
\end{verbatim}

\begin{verbatim}
## # A tibble: 788 x 5
## # Groups:   id_cliente [394]
##    id_cliente tipo_milhas       media mediana desvio_padrao
##         <dbl> <chr>             <dbl>   <dbl>         <dbl>
##  1          3 Milhas_Acumuladas  917     917            NA 
##  2          3 Milhas_Utilizadas 1023    1023            NA 
##  3          7 Milhas_Acumuladas 2583    2583             0 
##  4          7 Milhas_Utilizadas 7074.   7074.         3358.
##  5         10 Milhas_Acumuladas 3829    3829            NA 
##  6         10 Milhas_Utilizadas 6537    6537            NA 
##  7         12 Milhas_Acumuladas 8857    8857            NA 
##  8         12 Milhas_Utilizadas 9312    9312            NA 
##  9         13 Milhas_Acumuladas 2228    2228            NA 
## 10         13 Milhas_Utilizadas 4123    4123            NA 
## # i 778 more rows
\end{verbatim}

\end{document}
